# Race Conditions

Dieses Dokument bietet eine verständliche Erläuterung von Race Conditions in Softwareanwendungen – inklusive Definition, Typen und realer Beispiele.

---

## 1. Was ist eine Race Condition?

Eine **Race Condition** tritt auf, wenn zwei oder mehr Prozesse oder Threads gleichzeitig auf gemeinsame Ressourcen zugreifen – und das Endergebnis davon abhängt, in welcher Reihenfolge dieser Zugriff erfolgt.  
Das Problem entsteht, wenn die Anwendung **nicht darauf vorbereitet ist**, dass bestimmte Abläufe gleichzeitig oder in unerwarteter Reihenfolge ablaufen.

> "Zwei Ereignisse geschehen nahezu gleichzeitig in einer Anwendung, und die Anwendung berücksichtigt nicht, dass diese beiden Bedingungen gleichzeitig eintreten können."

Dies kann zu **unerwartetem Verhalten oder Sicherheitslücken** führen, da die resultierende Ausgabe nicht vorhersehbar oder inkorrekt sein kann.

---

## 2. TOCTOU-Angriff (Time-of-Check to Time-of-Use)

Ein häufiger Sonderfall von Race Conditions ist der sogenannte **TOCTOU-Angriff** (*Time-of-Check to Time-of-Use*).  

Dabei prüft eine Anwendung zuerst eine Bedingung (z. B. ob eine Datei existiert oder ob ein Nutzer eine Berechtigung besitzt) – und **verwendet das Ergebnis dieser Prüfung später**, ohne es nochmals zu verifizieren.

> „Ein anderer Prozess kann zwischen der Prüfung und der Verwendung des Wertes eingreifen.“

**Folge:** Ein Angreifer kann das Ergebnis zwischenzeitlich manipulieren (z. B. durch Ändern der Datei oder der Rechte), was zu Sicherheitsproblemen führt.

---

## 3. Beispiel: Race Condition bei einer Geldüberweisung

Ein anschauliches Beispiel für eine Race Condition:

### Szenario:

- Zwei Benutzer (User A und B) führen **gleichzeitig** eine Überweisung von Konto A auf Konto B durch.
- Anfangsstand: Konto A = 100 $, Konto B = 100 $.

### Ablauf:

1. Beide Benutzer prüfen den aktuellen Kontostand von Konto A → sehen je 100 $.
2. Benutzer A überweist 50 $ auf Konto B → Konto B zeigt 150 $.
3. Benutzer B überweist ebenfalls 50 $ auf Konto B → Konto B zeigt nun 200 $.
4. Benutzer A zieht 50 $ von Konto A ab → Konto A: 50 $.
5. Benutzer B zieht 50 $ von Konto A ab → Konto A: erneut 50 $, weil der Abzug von Benutzer A nicht berücksichtigt wurde.

> Die Anwendung aktualisiert den Kontostand **nicht global synchronisiert**.

### Ergebnis:

- Konto A sollte eigentlich **0 $** aufweisen.
- Stattdessen bleibt **ein doppelter Zugriff möglich**, da **beide Transaktionen unabhängig** voneinander auf dieselbe Information zugreifen konnten.

---

## 4. Reale Beispiele für Race Conditions

### Mars Rover "Spirit" (2004)

- **Problem:** Bei einem Dateisystemfehler wurde der Rover automatisch neu gestartet.
- Durch eine Race Condition trat derselbe Fehler erneut auf → **Endlosschleife mit Neustarts**.
- **Lösung:** Ein Software-Patch wurde zur Erde gesendet und anschließend zum Rover übertragen.

### Tesla Model 3 (Pwn2Own 2023)

- **Problem:** Ein TOCTOU-Angriff ermöglichte den Zugriff auf das **Infotainmentsystem via Bluetooth**.
- **Auswirkung:** Die Angreifer erlangten **Root-Zugriff**.
- **Belohnung:** 100.000 $ Preisgeld und das Fahrzeug als Gewinn.

---

## 5. Fazit

**Race Conditions** sind schwer zu entdecken, aber sie können schwerwiegende Sicherheitsrisiken darstellen.  
Wenn zeitkritische Prüfungen und Aktionen nicht sauber voneinander getrennt sind, **können Angreifer Systeme manipulieren**, Berechtigungen umgehen oder ungewollte Zustände erzeugen.

**Empfehlung:**  
- Nutze Synchronisationsmechanismen (z. B. Locking, Atomic Operations).
- Wiederhole Prüfungen unmittelbar vor der Nutzung kritischer Ressourcen.
- Teste sicherheitsrelevante Prozesse auf Parallelitätsprobleme.

> Die Vermeidung von Race Conditions ist essenziell für die **Integrität und Sicherheit** moderner Softwareanwendungen.
---
QUELLE: https://www.youtube.com/watch?v=MKptc1lPSw8&list=PLG49S3nxzAnl4QDVqK-hOnoqcSKEIDDuv&index=28
